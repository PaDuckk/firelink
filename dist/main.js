#!/usr/bin/env node
(function () {var e={};Object.defineProperty(e,"__esModule",{value:!0});const i=require("child_process");var a=({command:r,args:e,cwd:s}={command:"npx",args:[]},o=!0)=>new Promise(($,p)=>{const c=i.spawn(r,e,{cwd:s});o&&c.stderr.pipe(process.stderr),o&&c.stdout.pipe(process.stdout),c.on("close",r=>0!==r?p(!!r):$(!!r))});e.Worker=a;var b={};Object.defineProperty(b,"__esModule",{value:!0});var o=e=>process.argv.toString().includes(e);b.includes=o;var l=(e,r=!0,t=e=>e)=>{if(process.argv.toString().includes(e)){const s=process.argv[process.argv.indexOf(e)+1];return s?s.includes("--")?r:t(s):r}return r};b.nextOrDefault=l;var d={},f=d&&d.__awaiter||function(e,i,r,a){return new(r||(r=Promise))(function($,s){function o(e){try{t(a.next(e))}catch(i){s(i)}}function n(e){try{t(a.throw(e))}catch(i){s(i)}}function t(e){var i;e.done?$(e.value):(i=e.value,i instanceof r?i:new r(function(e){e(i)})).then(o,n)}t((a=a.apply(e,i||[])).next())})};Object.defineProperty(d,"__esModule",{value:!0});const g=require("fs"),k=require("util"),j=require("path"),h=".packages";function m(){return f(this,void 0,void 0,function*(){const e=JSON.parse((yield k.promisify(g.readFile)(j.join(process.cwd(),"package.json"),{encoding:"utf-8"}))),i=JSON.parse(JSON.stringify(e));function r(){g.writeFileSync(j.join(process.cwd(),"package.json"),JSON.stringify(i,null,2),{encoding:"utf-8"}),process.exit()}try{if(e&&e.fireDependencies){const i=e.fireDependencies,$=Object.keys(i).map(e=>({dep:e,folder:i[e]}));yield Promise.all($.map(({folder:e})=>f(this,void 0,void 0,function*(){const i=["-r","--exclude","node_modules","--exclude","dist","--exclude",".cache",e,`./${h}`];yield a({command:"rsync",args:i})})));try{b.includes("--buildCommand")&&(yield Promise.all((yield k.promisify(g.readdir)(j.join(process.cwd(),h))).map(e=>f(this,void 0,void 0,function*(){yield a({command:"npx",args:[b.nextOrDefault("--buildCommand","tsc")],cwd:j.join(process.cwd(),h,e)},!1)}))))}catch(a){}process.stdin.resume(),process.on("exit",r),process.on("SIGINT",r),process.on("SIGUSR1",r),process.on("SIGUSR2",r),process.on("uncaughtException",r),yield function(){return f(this,void 0,void 0,function*(){yield Promise.all($.map(({dep:i})=>f(this,void 0,void 0,function*(){e.dependencies[i]=`file:./${h}/${i.split("/")[1]}`}))),yield k.promisify(g.writeFile)("./package.json",JSON.stringify(e,null,2),{encoding:"utf-8"})})}(),yield a({command:"npx",args:["firebase",...process.argv.slice(2)]})}else yield a({command:"npx",args:["firebase",...process.argv.slice(2)]})}catch(a){console.log(a)}r()})}var n=m;d.createFirebasePackageSymlink=n;var c={},p=c&&c.__awaiter||function(e,a,n,r){return new(n||(n=Promise))(function(c,t){function i(e){try{f(r.next(e))}catch(a){t(a)}}function $(e){try{f(r.throw(e))}catch(a){t(a)}}function f(e){var a;e.done?c(e.value):(a=e.value,a instanceof n?a:new n(function(e){e(a)})).then(i,$)}f((r=r.apply(e,a||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0});function q(){return p(this,void 0,void 0,function*(){yield d.createFirebasePackageSymlink()})}q();if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=c}else if(typeof define==="function"&&define.amd){define(function(){return c})}})();