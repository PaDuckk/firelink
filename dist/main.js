#!/usr/bin/env node
(function () {var w={};Object.defineProperty(w,"__esModule",{value:!0});const C=require("child_process");var d=({command:r,args:e,cwd:s}={command:"npx",args:[]},o=!0)=>new Promise(($,p)=>{const c=C.spawn(r,e,{cwd:s});o&&c.stderr.pipe(process.stderr),o&&c.stdout.pipe(process.stdout),c.on("close",r=>0!==r?p(!!r):$(!!r))});w.Worker=d;var o={};Object.defineProperty(o,"__esModule",{value:!0});var l=e=>process.argv.toString().includes(e);o.includes=l;var z=(e,r=!0,t=e=>e)=>{if(process.argv.toString().includes(e)){const s=process.argv[process.argv.indexOf(e)+1];return s?s.includes("--")?r:t(s):r}return r};o.nextOrDefault=z;var e={},$=e&&e.__awaiter||function(r,e,$,t){return new($||($=Promise))(function(n,a){function o(r){try{J(t.next(r))}catch(e){a(e)}}function i(r){try{J(t.throw(r))}catch(e){a(e)}}function J(r){var e;r.done?n(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(o,i)}J((t=t.apply(r,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const L=require("util"),M=require("fs"),U=require("path");function W(r){return $(this,void 0,void 0,function*(){return JSON.parse((yield L.promisify(M.readFile)(U.join(process.cwd(),r),{encoding:"utf-8"})))})}var n=W;e.readJson=n;var s={};Object.defineProperty(s,"__esModule",{value:!0});const _=require("fs"),F=require("path");function G(e,$){_.writeFileSync(F.join(process.cwd(),e),JSON.stringify($,null,2),{encoding:"utf-8"})}var f=G;s.writeFileJson=f;var g={},N=g&&g.__awaiter||function(e,n,r,$){return new(r||(r=Promise))(function(t,o){function a(e){try{w($.next(e))}catch(n){o(n)}}function i(e){try{w($.throw(e))}catch(n){o(n)}}function w(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r(function(e){e(n)})).then(a,i)}w(($=$.apply(e,n||[])).next())})};Object.defineProperty(g,"__esModule",{value:!0});const P=require("util"),S=require("fs");function T(){return N(this,void 0,void 0,function*(){f("package.json",(yield n("package.temp.json"))),yield P.promisify(S.unlink)("package.temp.json")})}var q=T;g.revertJson=q;var r={};Object.defineProperty(r,"__esModule",{value:!0});var b=".packages";r.linkedPackagesName=b;var i={},B=i&&i.__awaiter||function(e,i,$,n){return new($||($=Promise))(function(t,o){function r(e){try{p(n.next(e))}catch(i){o(i)}}function a(e){try{p(n.throw(e))}catch(i){o(i)}}function p(e){var i;e.done?t(e.value):(i=e.value,i instanceof $?i:new $(function(e){e(i)})).then(r,a)}p((n=n.apply(e,i||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});const ba=require("util"),D=require("fs");function E(e,i){return B(this,void 0,void 0,function*(){yield Promise.all(i.map(({dep:i})=>B(this,void 0,void 0,function*(){e.dependencies[i]=`file:./${b}/${i.split("/")[1]}`}))),yield ba.promisify(D.writeFile)("./package.json",JSON.stringify(e,null,2),{encoding:"utf-8"})})}var p=E;i.modifyJson=p;var k={},H=k&&k.__awaiter||function(e,a,r,n){return new(r||(r=Promise))(function($,t){function i(e){try{o(n.next(e))}catch(a){t(a)}}function l(e){try{o(n.throw(e))}catch(a){t(a)}}function o(e){var a;e.done?$(e.value):(a=e.value,a instanceof r?a:new r(function(e){e(a)})).then(i,l)}o((n=n.apply(e,a||[])).next())})};Object.defineProperty(k,"__esModule",{value:!0});const I=require("util"),J=require("fs");function K(e){return H(this,void 0,void 0,function*(){l("--leave-changes")?(yield I.promisify(J.exists)("package.temp.json"))||f("package.temp.json",e):f("package.json",e),process.exit()})}var a=K;k.exitHandler=a;var j={},t=j&&j.__awaiter||function(r,e,$,a){return new($||($=Promise))(function(c,s){function t(r){try{i(a.next(r))}catch(e){s(e)}}function u(r){try{i(a.throw(r))}catch(e){s(e)}}function i(r){var e;r.done?c(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(t,u)}i((a=a.apply(r,e||[])).next())})};Object.defineProperty(j,"__esModule",{value:!0});const O=require("util"),u=require("path"),Q=require("fs");function R(){return t(this,void 0,void 0,function*(){return yield Promise.all((yield O.promisify(Q.readdir)(u.join(process.cwd(),b))).map(r=>t(this,void 0,void 0,function*(){yield d({command:"npx",args:z("--buildCommand","tsc").split(" "),cwd:u.join(process.cwd(),b,r)},!1)})))})}var v=R;j.buildPackages=v;var h={},x=h&&h.__awaiter||function(e,r,o,$){return new(o||(o=Promise))(function(a,n){function t(e){try{Q($.next(e))}catch(r){n(r)}}function c(e){try{Q($.throw(e))}catch(r){n(r)}}function Q(e){var r;e.done?a(e.value):(r=e.value,r instanceof o?r:new o(function(e){e(r)})).then(t,c)}Q(($=$.apply(e,r||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});function V(e){return x(this,void 0,void 0,function*(){yield Promise.all(e.map(({folder:e})=>x(this,void 0,void 0,function*(){const r=["-r","--exclude","node_modules","--exclude","dist","--exclude",".cache",e,`./${b}`];yield d({command:"rsync",args:r})})))})}var y=V;h.copyPackages=y;var m={},Y=m&&m.__awaiter||function(e,r,i,a){return new(i||(i=Promise))(function($,n){function t(e){try{s(a.next(e))}catch(r){n(r)}}function o(e){try{s(a.throw(e))}catch(r){n(r)}}function s(e){var r;e.done?$(e.value):(r=e.value,r instanceof i?r:new i(function(e){e(r)})).then(t,o)}s((a=a.apply(e,r||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});function Z(){return Y(this,void 0,void 0,function*(){const e=yield n("package.json");e.fireConfig=e.fireConfig||{};let r=e.fireConfig.runner||"firebase";const i=JSON.parse(JSON.stringify(e));if(l("--revert-changes"))return yield q();if(e&&e.fireDependencies){const r=e.fireDependencies,$=Object.keys(r).map(e=>({dep:e,folder:r[e]}));if(yield y($),l("--buildCommand"))try{yield v()}catch(a){}process.stdin.resume(),process.on("exit",()=>a(i)),process.on("SIGINT",()=>a(i)),process.on("SIGUSR1",()=>a(i)),process.on("SIGUSR2",()=>a(i)),process.on("uncaughtException",()=>a(i)),yield p(e,$)}yield d({command:"npx",args:[r,...process.argv.slice(2).filter(e=>"--leave-changes"!==e&&"--revert-changes"!==e&&"--buildCommand"!==e)]}),a(i)})}var A=Z;m.createVirtualSymlink=A;var c={},aa=c&&c.__awaiter||function(e,a,n,r){return new(n||(n=Promise))(function(c,t){function i(e){try{f(r.next(e))}catch(a){t(a)}}function $(e){try{f(r.throw(e))}catch(a){t(a)}}function f(e){var a;e.done?c(e.value):(a=e.value,a instanceof n?a:new n(function(e){e(a)})).then(i,$)}f((r=r.apply(e,a||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0});function X(){return aa(this,void 0,void 0,function*(){try{yield A()}catch(e){console.log(e)}})}X();if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=c}else if(typeof define==="function"&&define.amd){define(function(){return c})}})();